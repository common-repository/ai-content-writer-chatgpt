var eventGenerator=!1,acwc_limited_token=!1;function acwcBasicEditor(){var e=!0;if(acwc_prompt_logged){var t=tinyMCE.get("acwc_prompt_result");document.getElementById("wp-acwc_prompt_result-wrap").classList.contains("tmce-active")&&t&&(e=!1)}return e}function acwcSetContent(e){"textarea"===acwcResponseType?acwcBasicEditor()?document.getElementById("acwc_prompt_result").value=e:tinyMCE.get("acwc_prompt_result").setContent(e):document.getElementById("acwc_prompt_result").innerHTML=e}function acwcGetContent(){if("textarea"===acwcResponseType){if(acwcBasicEditor())return document.getElementById("acwc_prompt_result").value;var e=tinyMCE.get("acwc_prompt_result").getContent();return e=e.replace(/<\/?p(>|$)/g,"")}return document.getElementById("acwc_prompt_result").innerHTML}function acwcLoadingBtn(e){e.setAttribute("disabled","disabled"),e.innerHTML+='<span class="acwc_loader"></span>'}function acwcRmLoading(e){e.removeAttribute("disabled"),e.removeChild(e.getElementsByTagName("span")[0])}function acwcEventClose(){acwcStop.style.display="none",acwc_limited_token||(acwcSaveResult.style.display="block"),acwcRmLoading(acwcGenerateBtn),eventGenerator.close()}function acwcValidEmail(e){return String(e).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)}function acwcValidUrl(e){try{return new URL(e),!0}catch(e){return!1}}var acwc_break_newline=acwcUserLoggedIn?"<br/><br />":"\n\n";"undefined"!=typeof acwcForm&&null!=acwcForm&&acwcForm.length&&acwcForm.addEventListener("submit",(function(e){e.preventDefault();var t=acwcMaxToken.value,a=acwcTemperature.value,n=acwcTopP.value,c=acwcBestOf.value,r=acwcFP.value,o=acwcPP.value,l=!1,i=acwcPromptTitle.value;if(""===i?l="Please insert prompt":""===t?l="Please enter max tokens":parseFloat(t)<1||parseFloat(t)>8e3?l="Please enter a valid max tokens value between 1 and 8000":""===a?l="Please enter temperature":parseFloat(a)<0||parseFloat(a)>1?l="Please enter a valid temperature value between 0 and 1":""===n?l="Please enter Top P":parseFloat(n)<0||parseFloat(n)>1?l="Please enter a valid Top P value between 0 and 1":""===c?l="Please enter best of":parseFloat(c)<1||parseFloat(c)>20?l="Please enter a valid best of value between 0 and 1":""===r?l="Please enter frequency penalty":parseFloat(r)<0||parseFloat(r)>2?l="Please enter a valid frequency penalty value between 0 and 2":""===o?l="Please enter presence penalty":(parseFloat(o)<0||parseFloat(o)>2)&&(l="Please enter a valid presence penalty value between 0 and 2"),l)alert(l);else{if("object"==typeof acwcFormFields)for(var s=0;s<acwcFormFields.length;s++){var d=acwcFormFields[s],w=document.getElementById("acwc_form_field-"+s),p=void 0!==d.type?d.type:"text",m=void 0!==d.label?d.label:"",u=void 0!==d.min?d.min:"",v=void 0!==d.max?d.max:"";if("radio"!==p&&"checkbox"!==p){var f=w.value;"text"===p||"textarea"===p||"email"===p||"url"===p?""!==u&&f.length<parseInt(u)?l=m+" minimum "+u+" characters":""!==v&&f.length>parseInt(v)?l=m+" maximum "+v+" characters":"email"!==p||acwcValidEmail(f)?"url"!==p||acwcValidUrl(f)||(l=m+" must be url"):l=m+" must be email address":"number"===p&&(""!==u&&parseFloat(f)<parseInt(u)?l=m+" minimum "+u:""!==v&&parseFloat(f)>parseInt(v)&&(l=m+" maximum "+v))}else if("checkbox"===p||"radio"===p){var _=!1;if((y=w.getElementsByTagName("input"))&&y.length)for(var g=0;g<y.length;g++){(b=y[g]).checked&&(_=!0)}_||(l=m+" is required")}}if(l)alert(l);else{let e=new Date;if("object"==typeof acwcFormFields)for(s=0;s<acwcFormFields.length;s++){p=(d=acwcFormFields[s]).type,w=document.getElementById("acwc_form_field-"+s);var y,F=void 0!==d.id?d.id:"";if("checkbox"===p||"radio"===p){if(f="",(y=w.getElementsByTagName("input"))&&y.length)for(g=0;g<y.length;g++){var b;if((b=y[g]).checked){var E=b.value;void 0!==E&&""!==E&&(f+=(""===f?"":", ")+E)}}}else f=w.value;var S=new RegExp("{"+F+"}","g");i=i.replace(S,f)}acwcPromptTitleFilled.value=i+".\n\n";let t=new URLSearchParams(new FormData(acwcForm)).toString();acwcLoadingBtn(acwcGenerateBtn),acwcSaveResult.style.display="none",acwcStop.style.display="inline",acwcSetContent("");var h=0,P="";t+="&source_stream=form&nonce="+acwcAjaxNonce,eventGenerator=new EventSource(acwcEventURL+"&"+t);var B=0,x=!1;let a="";acwc_limited_token=!1,eventGenerator.onmessage=function(n){if(P=acwcGetContent(),"[DONE]"===n.data)h+=1,acwcSetContent(P+acwc_break_newline),B=0;else if("[LIMITED]"===n.data)acwc_limited_token=!0,h+=1,acwcSetContent(P+acwc_break_newline),B=0;else{var c=JSON.parse(n.data),r="";r=void 0!==c.error?c.error.message:void 0!==c.choices[0].delta?void 0!==c.choices[0].delta.content?c.choices[0].delta.content:"":c.choices[0].text,a+=r,("\n"===r||" \n"===r||".\n"===r||"\n\n"===r||".\n\n"===r)&&B>0&&""!==P?(console.log(P),x||(x=!0,acwcSetContent(P+acwc_break_newline))):"\n"===r&&0===B&&""===P||(x=!1,B+=1,acwcSetContent(P+r))}if(1===h){if(!acwc_limited_token){let n=new Date-e;n/=1e3,t+="&action=acwc_form_log&prompt_id="+acwcFormId+"&prompt_name="+acwcFormName+"&prompt_response="+a+"&duration="+n+"&_wpnonce="+acwcFormNonce+"&source_id="+acwcFormSourceID;const c=new XMLHttpRequest;c.open("POST",acwcAjaxUrl),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.send(t),c.onreadystatechange=function(e){c.readyState}}acwcEventClose()}}}}return!1})),"undefined"!=typeof acwcStop&&acwcStop.addEventListener("click",(function(e){e.preventDefault(),acwcEventClose()})),"undefined"!=typeof acwcClearBtn&&acwcClearBtn.addEventListener("click",(function(e){e.preventDefault(),acwcSetContent(""),acwcSaveResult.style.display="none"})),acwcUserLoggedIn&&"undefined"!=typeof acwcSaveDraftBtn&&acwcSaveDraftBtn.addEventListener("click",(function(e){e.preventDefault();var t=document.getElementById("acwc-prompt-post_title").value,a=acwcGetContent();if(""===t)alert("Please insert title");else if(""===a)alert("Please wait generate content");else{const e=new XMLHttpRequest;e.open("POST",acwcAjaxUrl),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send("action=acwc_save_draft_post_extra&title="+t+"&content="+a+"&save_source=promptbase&nonce="+acwcAjaxNonce),acwcLoadingBtn(acwcSaveDraftBtn),e.onreadystatechange=function(t){if(4===e.readyState)if(acwcRmLoading(acwcSaveDraftBtn),200===e.status){var a=this.responseText;"success"===(a=JSON.parse(a)).status?window.location.href=acwcAdminPost+"?post="+a.id+"&action=edit":alert(a.msg)}else alert("Something went wrong")}}}));